{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/Documents/Projects/PESU_EC_CSE_D_P25_Digital_Asset_and_Cryptocurrency_Portfolio_Tracker_Stash/src/middleware.ts"],"sourcesContent":["import { createServerClient, type CookieOptions } from '@supabase/ssr'\nimport { NextResponse, type NextRequest } from 'next/server'\n\nexport async function middleware(request: NextRequest) {\n  let response = NextResponse.next({\n    request: {\n      headers: request.headers,\n    },\n  })\n\n  const cookieStore = request.cookies\n  const supabase = createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        get(name: string) {\n          return cookieStore.get(name)?.value\n        },\n        set(name: string, value: string, options: CookieOptions) {\n          response.cookies.set(name, value, options)\n        },\n        remove(name: string, options: CookieOptions) {\n          response.cookies.set(name, '', options)\n        },\n      },\n    }\n  )\n\n  // Get the currently logged-in user\n  const { data: { user } } = await supabase.auth.getUser()\n  \n  const { pathname } = request.nextUrl\n\n  // --- Start of Protection Logic ---\n\n  // 1. If user is NOT logged in\n  if (!user) {\n    // Protect all dashboard routes\n    if (pathname.startsWith('/dashboard')) {\n      // Redirect unauthenticated users to the auth login page\n      return NextResponse.redirect(new URL('/auth/login', request.url))\n    }\n    // Allow access to all other pages (like auth pages, homepage)\n    return response\n  }\n\n  // 2. If user IS logged in\n\n  // If a logged-in user tries to go to login/register/auth pages, redirect them to their dashboard\n  if (\n    pathname.startsWith('/login') ||\n    pathname.startsWith('/register') ||\n    pathname.startsWith('/auth/login')\n  ) {\n    return NextResponse.redirect(new URL(`/dashboard/${user.id}`, request.url))\n  }\n\n  // Protect dashboard routes so only the owner (user.id) can access their dashboard path\n  if (pathname.startsWith('/dashboard')) {\n    // Split and preserve subpaths\n    const parts = pathname.split('/').filter(Boolean) // e.g. ['dashboard', '<id>', 'assets', ...]\n    const requestedId = parts[1] // may be undefined if URL is just '/dashboard' or '/dashboard/'\n    const tail = parts.slice(2).join('/') // preserve trailing segments after id\n\n    // If there's no id in URL or it doesn't match the logged-in user's id, redirect to correct dashboard path\n    if (!requestedId || requestedId !== user.id) {\n      const targetPath = `/dashboard/${user.id}${tail ? '/' + tail : ''}`\n      return NextResponse.redirect(new URL(targetPath, request.url))\n    }\n    // requestedId matches user.id => allow access\n  }\n\n  // Allow them to proceed to any other page\n  return response\n}\n\n// Config to match all routes except static files\nexport const config = {\n  matcher: [\n    /*\n      * Match all request paths except for the ones starting with:\n      * - _next/static (static files)\n      * - _next/image (image optimization files)\n      * - favicon.ico (favicon file)\n      */\n    '/((?!_next/static|_next/image|favicon.ico).*)',\n  ],\n}\n\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AAAA;;;AAEO,eAAe,WAAW,OAAoB;IACnD,IAAI,WAAW,8SAAY,CAAC,IAAI,CAAC;QAC/B,SAAS;YACP,SAAS,QAAQ,OAAO;QAC1B;IACF;IAEA,MAAM,cAAc,QAAQ,OAAO;IACnC,MAAM,WAAW,IAAA,qTAAkB,sUAGjC;QACE,SAAS;YACP,KAAI,IAAY;gBACd,OAAO,YAAY,GAAG,CAAC,OAAO;YAChC;YACA,KAAI,IAAY,EAAE,KAAa,EAAE,OAAsB;gBACrD,SAAS,OAAO,CAAC,GAAG,CAAC,MAAM,OAAO;YACpC;YACA,QAAO,IAAY,EAAE,OAAsB;gBACzC,SAAS,OAAO,CAAC,GAAG,CAAC,MAAM,IAAI;YACjC;QACF;IACF;IAGF,mCAAmC;IACnC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAEtD,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,oCAAoC;IAEpC,8BAA8B;IAC9B,IAAI,CAAC,MAAM;QACT,+BAA+B;QAC/B,IAAI,SAAS,UAAU,CAAC,eAAe;YACrC,wDAAwD;YACxD,OAAO,8SAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,eAAe,QAAQ,GAAG;QACjE;QACA,8DAA8D;QAC9D,OAAO;IACT;IAEA,0BAA0B;IAE1B,iGAAiG;IACjG,IACE,SAAS,UAAU,CAAC,aACpB,SAAS,UAAU,CAAC,gBACpB,SAAS,UAAU,CAAC,gBACpB;QACA,OAAO,8SAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,WAAW,EAAE,KAAK,EAAE,EAAE,EAAE,QAAQ,GAAG;IAC3E;IAEA,uFAAuF;IACvF,IAAI,SAAS,UAAU,CAAC,eAAe;QACrC,8BAA8B;QAC9B,MAAM,QAAQ,SAAS,KAAK,CAAC,KAAK,MAAM,CAAC,SAAS,4CAA4C;;QAC9F,MAAM,cAAc,KAAK,CAAC,EAAE,CAAC,gEAAgE;;QAC7F,MAAM,OAAO,MAAM,KAAK,CAAC,GAAG,IAAI,CAAC,KAAK,sCAAsC;;QAE5E,0GAA0G;QAC1G,IAAI,CAAC,eAAe,gBAAgB,KAAK,EAAE,EAAE;YAC3C,MAAM,aAAa,CAAC,WAAW,EAAE,KAAK,EAAE,GAAG,OAAO,MAAM,OAAO,IAAI;YACnE,OAAO,8SAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,YAAY,QAAQ,GAAG;QAC9D;IACA,8CAA8C;IAChD;IAEA,0CAA0C;IAC1C,OAAO;AACT;AAGO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;MAKE,GACF;KACD;AACH"}}]
}