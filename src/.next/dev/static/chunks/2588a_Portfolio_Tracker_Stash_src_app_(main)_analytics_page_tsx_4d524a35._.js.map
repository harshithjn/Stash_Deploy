{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/harshithj/Documents/Projects/PESU_EC_CSE_D_P25_Digital_Asset_and_Cryptocurrency_Portfolio_Tracker_Stash/src/app/%28main%29/analytics/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { createClient } from \"../../../lib/supabase/supabaseClient\"; // ✅ use correct path\nimport {\n  LineChart,\n  Line,\n  PieChart,\n  Pie,\n  Cell,\n  Tooltip,\n  XAxis,\n  YAxis,\n  ResponsiveContainer,\n} from \"recharts\";\nimport { motion } from \"framer-motion\";\n\nexport default function AnalyticsPage() {\n  const supabase = createClient();\n  const router = useRouter();\n\n  const [user, setUser] = useState<any>(null);\n  const [roiData, setRoiData] = useState<any[]>([]);\n  const [allocData, setAllocData] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  // ✅ Fetch user session & analytics data\n  useEffect(() => {\n    const fetchAnalytics = async () => {\n      setLoading(true);\n\n      // 1️⃣ Get authenticated user\n      const {\n        data: { user },\n        error: userError,\n      } = await supabase.auth.getUser();\n\n      if (userError || !user) {\n        router.push(\"/login\"); // redirect if not logged in\n        return;\n      }\n\n      setUser(user);\n\n      // 2️⃣ Fetch user-specific ROI data\n      const { data, error } = await supabase\n        .from(\"roi_history\")\n        .select(\"date, roi_percentage, asset_allocation\")\n        .eq(\"user_id\", user.id) // ✅ make sure analytics is user-specific\n        .order(\"date\", { ascending: true });\n\n      if (error) {\n        console.error(\"Error fetching analytics:\", error.message);\n        setLoading(false);\n        return;\n      }\n\n      if (data && data.length > 0) {\n        setRoiData(data.map((d) => ({ date: d.date, roi: d.roi_percentage })));\n\n        const alloc = data[data.length - 1]?.asset_allocation || {};\n        const formattedAlloc = Object.entries(alloc).map(([k, v]) => ({\n          name: k,\n          value: v,\n        }));\n        setAllocData(formattedAlloc);\n      }\n\n      setLoading(false);\n    };\n\n    fetchAnalytics();\n  }, [supabase, router]);\n\n  const COLORS = [\"#00C49F\", \"#FFBB28\", \"#FF8042\", \"#8884d8\", \"#FF6666\"];\n\n  // ✅ UI Rendering\n  return (\n    <div className=\"min-h-screen bg-black text-white p-6\">\n      <div className=\"max-w-6xl mx-auto\">\n        <h1 className=\"text-3xl font-bold mb-8\">Analytics Dashboard</h1>\n\n        {loading ? (\n          <div className=\"text-gray-500 text-center mt-20 animate-pulse\">\n            Loading analytics...\n          </div>\n        ) : !user ? (\n          <div className=\"text-center text-gray-400 mt-10\">\n            Please log in to view analytics.\n          </div>\n        ) : (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            className=\"space-y-10\"\n          >\n            {/* ROI Chart */}\n            <section className=\"bg-[#0b0b0b] border border-gray-800 rounded-2xl p-6\">\n              <h2 className=\"text-xl font-semibold mb-4\">ROI Trend</h2>\n              <ResponsiveContainer width=\"100%\" height={300}>\n                <LineChart data={roiData}>\n                  <XAxis dataKey=\"date\" stroke=\"#666\" />\n                  <YAxis stroke=\"#666\" />\n                  <Tooltip\n                    contentStyle={{\n                      backgroundColor: \"#111\",\n                      border: \"1px solid #333\",\n                      color: \"#fff\",\n                    }}\n                  />\n                  <Line\n                    type=\"monotone\"\n                    dataKey=\"roi\"\n                    stroke=\"#00C49F\"\n                    strokeWidth={2}\n                    dot={false}\n                  />\n                </LineChart>\n              </ResponsiveContainer>\n            </section>\n\n            {/* Asset Allocation */}\n            <section className=\"bg-[#0b0b0b] border border-gray-800 rounded-2xl p-6\">\n              <h2 className=\"text-xl font-semibold mb-4\">Asset Allocation</h2>\n              {allocData.length > 0 ? (\n                <ResponsiveContainer width=\"100%\" height={300}>\n                  <PieChart>\n                    <Pie\n                      data={allocData}\n                      dataKey=\"value\"\n                      nameKey=\"name\"\n                      outerRadius={100}\n                      label\n                    >\n                      {allocData.map((_, index) => (\n                        <Cell\n                          key={index}\n                          fill={COLORS[index % COLORS.length]}\n                        />\n                      ))}\n                    </Pie>\n                    <Tooltip\n                      contentStyle={{\n                        backgroundColor: \"#111\",\n                        border: \"1px solid #333\",\n                        color: \"#fff\",\n                      }}\n                    />\n                  </PieChart>\n                </ResponsiveContainer>\n              ) : (\n                <div className=\"text-gray-500 text-center py-10\">\n                  No asset allocation data found.\n                </div>\n              )}\n            </section>\n          </motion.div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}